---
layout: post
title: "Basic Pentesting"
date: 2022-10-21
categories: [Tryhackme, Easy-THM]
tags: [dirsearch, SMB, bruteforcing, ssh2john, JTR]
image: ../../assets/img/posts/basicpentesting.png 

---

## Description

This is a machine that allows you to practise web app hacking and privilege escalation.

|**Room**|[Basic Pentesting](https://tryhackme.com/room/basicpentestingjt)|
|:---:|:---:|
|**OS**|Linux|
|**Difficulty**|Easy|
|**Creator**|[ashu](https://tryhackme.com/p/ashu)|

---

Let's start with port scanning which can be done with nmap,

```bash
nmap -sV -sC 10.10.168.119 -oN nmap.txt
```

![image](https://user-images.githubusercontent.com/67465230/183442570-63671371-04c8-423c-b9b2-713096db52cf.png)

We got some open ports 22 (ssh), 80 (http), 139,445 (samba) which seems fine for us in this machine.

Let's start with enumerating website by visiting http://10.10.168.119,

![image](https://user-images.githubusercontent.com/67465230/183442625-c7011d1d-a94e-44cb-971f-d44e8fc60623.png)

The site is under maintenance. Let's check it's source code,

![image](https://user-images.githubusercontent.com/67465230/183442696-ae60fc08-b68c-4ff6-be46-87bd54bcc55d.png)

There's a comment left, says, we can visit dev note section. Might be worth checking it.

But first let's brute force directories using dirseach,

```bash
python3 /home/kali/tools/dirsearch/dirsearch.py -u http://10.10.168.119 -e txt,php -i 200,301 -o dirsearch.py
```

![image](https://user-images.githubusercontent.com/67465230/183442746-88e756a9-7d12-411a-b38a-69b421b443e3.png)

we got /development directory. Let's navigate to it.

Visiting http://10.10.168.119/development,

![image](https://user-images.githubusercontent.com/67465230/183442801-72ecddf8-bbfe-40fc-8080-e31284da986a.png)

we got 2 text files but only j.txt seems valuable to us,

![image](https://user-images.githubusercontent.com/67465230/183442863-5a207b08-d1b6-46a8-ba4d-cbfb06dd5d46.png)

Seems like we can brute force the password of J user.

Now, that we've enumerated website, let's enumerate shares using smbclient,

```bash
smbclient -L //10.10.168.119
```

![image](https://user-images.githubusercontent.com/67465230/183442965-c22bad95-f86a-45ca-9dc4-a7f82ea0bbab.png)

we got Anonymous share open. Let's try to access it.

```bash
smbclient \\\\10.10.168.119\\Anonymous
```

![image](https://user-images.githubusercontent.com/67465230/183445257-bc2b8179-0549-461a-92b3-df10f7d69ee0.png)

Establishing content with `ls` and we got **staff.txt** file. 

Let's download this file on our system using `get` command,

```bash
get staff.txt
```

![image](https://user-images.githubusercontent.com/67465230/183443031-81f9d7e6-06f7-4814-a66d-3c273dfae6af.png)

Now, that we've downloaded the file on our system, let's view file's content,

```bash
cat staff.txt
```

![image](https://user-images.githubusercontent.com/67465230/183443228-ad70fb72-12b1-4a8a-8128-759684b37df4.png)

By reading this, we got that user is Jay and we've to brute force their password and we can achieve this using **hydra** tool.

```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.168.119:22/ -t 4
```

![image](https://user-images.githubusercontent.com/67465230/183443358-3e98bd48-12ff-485b-9632-96329f4b641b.png)

we got password!! Let's authenticate ourselves.

```bash
ssh jan@10.10.168.119
```

![image](https://user-images.githubusercontent.com/67465230/183443434-2b00b206-229d-4cc2-a0ad-487fe1b1ba0b.png)

We got in!

After enumerating it a bit, I found another user in home directory, kay. Let's navigate into kay's directory and establish contents using `ls -la`,

![image](https://user-images.githubusercontent.com/67465230/183443508-f1d83b0d-2789-4e83-bf62-e3674957f06d.png)

we got many directory and a **pass.bak** file.

Let's try to read pass.bak file,

```bash
cat pass.bak
```

![image](https://user-images.githubusercontent.com/67465230/183443572-13fa1e7c-19ae-420b-a16f-68a7f8d5d1be.png)

we got Permission denied! We can't read this file because owner of this file is kay user and we (as a jan user) don't have privileges of kay user. 

Let's establish content of *.ssh* directory,

```bash
ls -la .ssh
```

![image](https://user-images.githubusercontent.com/67465230/183443653-54d80b66-7083-4dfc-afa8-fd943db38ae4.png)

we got id_rsa private/public key pair and an authorized_keys file

Time for Lateral Privilege Escalation because there is another user **kay** from which we can gain root. Let's find our way to get to kay user.

Let's copy id_rsa file content on our local machine and we can crack this key using JohnTheRipper.

```bash
/usr/share/john/ssh2john.py id_rsa > john.hash
```

![image](https://user-images.githubusercontent.com/67465230/183443830-24f8d846-d19f-444d-964f-06443002e35d.png)

we get a john-crackable file that we can crack,

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt john.hash
```

![image](https://user-images.githubusercontent.com/67465230/183443898-d7838e16-8c7f-4453-a56f-901230f462dc.png)

we got the password! Let's try to ssh as kay user with id_rsa file,

```bash
ssh -i id_rsa kay@10.10.168.119
```

![image](https://user-images.githubusercontent.com/67465230/183443942-ddf74a0c-8883-4926-a30c-4e722af2b889.png)

Let's establish directory content using `ls`,

![image](https://user-images.githubusercontent.com/67465230/183444017-fbc75868-1cac-4f69-a870-cef51c82736b.png)

we can see pass.bak file and since we're kay user, we can read the pass.bak file and after reading it, we got a long password.

Here comes Privilege Escalation.

Let's try to use this password to become superuser,

```bash
sudo su
```

![image](https://user-images.githubusercontent.com/67465230/183444124-7ddb915a-2b7a-4687-af23-05d152a8c6aa.png)

YAY! we're root now!!

There's a flag in /root directory,

![image](https://user-images.githubusercontent.com/67465230/183444206-49448020-2c19-4fc4-ace0-2732036000b3.png)

Read the flag,

![image](https://user-images.githubusercontent.com/67465230/183445025-29479dcd-317e-4205-9de3-28fe485ef423.png)

We have completed this machine.